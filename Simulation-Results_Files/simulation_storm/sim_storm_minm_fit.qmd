---
title: "Minimum Fitness"
author: Shashank Pritam
listing: default
toc: true
number-sections: true
highlight-style: pygments
format: 
  gfm: 
    code-fold: true
    html-math-method: katex
---

## Introduction

With this simulation we wanted to understand the role of insertion bias
on minimum fitness during a TEs invasion.

### Initial conditions:


## Materials & Methods

version: invadego0.1.3

### Commands for the simulation:

The simulations were generated using the code from:

- [sim_storm.py](sim_storm.py)


### Visualization in R

#### Setting the environment
```{r}
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
library(patchwork)
library(dplyr)
theme_set(theme_bw())
```


#### Data loading and parsing
```{r}

# Define and load DataFrame with column names
column_names <- c("rep", "gen", "popstat", "spacer_1", "fwte", "avw", "min_w", "avtes", "avpopfreq", "fixed", "spacer_2", "phase", "fwcli", "avcli", "fixcli", "spacer_3", "avbias", "3tot", "3cluster", "spacer_4", "sampleid")
df <- read_delim('/Users/shashankpritam/github/Insertion-Bias-TE/Simulation-Results_Files/simulation_storm/21thAug23at045659PM/combined.txt', delim='\t', col_names = column_names)

# Convert specific columns to numeric
numeric_columns <- c("rep", "gen", "fwte", "avw", "min_w", "avtes", "avpopfreq", "fixed", "fwcli", "avcli", "fixcli", "avbias", "sampleid")
df[numeric_columns] <- lapply(df[numeric_columns], as.numeric)
```

#### Visualization:
```{r}
# Define color gradient functions
color.gradient <- function(x, colors=c("#D7191C","#FDAE61","#A6D96A","#1A9641"), colsteps=100) { colorRampPalette(colors) (colsteps) [ findInterval(x, seq(min(df$min_w),1.0, length.out=colsteps)) ] }

# Assign colors based on the 'min_w' column
df$col <- color.gradient(df$min_w)
df[df$popstat == "fail-0",]$col <- "grey"
df$col <- as.factor(df$col)

# Create and plot the ggplot object
# Subset the data for gen 5000
df_gen_5000 <- df[df$gen == 5000,]
```


### Plot 1: Phase vs Average Bias at gen 5000
Here we are plotting the phase of the simulation or experiment against the average bias in TE insertion at generation 5000. The different phases are color-coded.

```{r}
g_avbias_phase <- ggplot(df_gen_5000, aes(x = avbias, y = phase, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("Phase of Invasion") +
  xlab("Average Bias in TE Insertion") +
  labs(title = "Phase vs Average Bias at gen 5000",
       subtitle = "Different phases represented by colors") +
  theme_minimal() +
  theme(legend.position = "bottom", panel.background = element_rect(fill="grey90"))

# Display the plot
plot(g_avbias_phase)
```



### Plot 3: Plot for min_w, avtes and avpopfreq vs avbias with phase as a factor

```{r}
# Plot for min_w vs avbias
plot_min_w <- ggplot(df_gen_5000, aes(x = avbias, y = min_w, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("min_w") +
  xlab("Average Bias") +
  labs(title = "Minimum Fitness (min_w) vs Average Bias at gen 5000",
       subtitle = "min_w: Minimum Fitness among Population") +
  theme_minimal()

# Plot for avtes vs avbias
plot_avtes <- ggplot(df_gen_5000, aes(x = avbias, y = avtes, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("avtes") +
  xlab("Average Bias") +
  labs(title = "Average TE Count (avtes) vs Average Bias at gen 5000",
       subtitle = "avtes: Average Number of TE Insertions") +
  theme_minimal()

# Plot for avpopfreq vs avbias
plot_avpopfreq <- ggplot(df_gen_5000, aes(x = avbias, y = avpopfreq, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("avpopfreq") +
  xlab("Average Bias") +
  labs(title = "Average Population Frequency (avpopfreq) vs Average Bias at gen 5000",
       subtitle = "avpopfreq: Average Frequency of TE in Population") +
  theme_minimal()

# Combine the plots
combined_plot <- plot_min_w / plot_avtes / plot_avpopfreq

# Display the combined plot
plot(combined_plot)

```


### Plot 5: min_w, avtes, avpopfreq vs Average Bias at gen 5000 with phase as a factor
```{r}

# Plot for fwcli vs avbias
plot_fwcli <- ggplot(df_gen_5000, aes(x = avbias, y = fwcli, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("fwcli") +
  xlab("Average Bias") +
  labs(title = "Fitness Weight of Cluster Insertions vs Average Bias at gen 5000") +
  theme_minimal()

# Plot for avcli vs avbias
plot_avcli <- ggplot(df_gen_5000, aes(x = avbias, y = avcli, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("avcli") +
  xlab("Average Bias") +
  labs(title = "Average Number of Cluster Insertions vs Average Bias at gen 5000") +
  theme_minimal()

# Plot for fixcli vs avbias
plot_fixcli <- ggplot(df_gen_5000, aes(x = avbias, y = fixcli, color = phase)) +
  geom_point(alpha = 0.7, size = 0.8) +
  ylab("fixcli") +
  xlab("Average Bias") +
  labs(title = "Number of Fixed Cluster Insertions vs Average Bias at gen 5000") +
  theme_minimal()

# Combine the plots
combined_plot <- plot_fwcli / plot_avcli / plot_fixcli

# Display the combined plot
plot(combined_plot)
```

